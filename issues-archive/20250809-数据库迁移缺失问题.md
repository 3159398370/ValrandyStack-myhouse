# 数据库迁移缺失问题

## 📋 问题概述

**发现时间**：2025年8月9日  
**影响严重性**：⭐⭐⭐⭐ (4星 - 高) - API接口500错误，影响项目功能展示  
**问题描述**：Django后端API接口返回500错误，数据库表不存在  
**影响范围**：项目展示页面、作品集功能  

**标签**：`#后端` `#数据库` `#Django` `#迁移`

## 🔍 根本原因

### 主要问题
1. **数据库迁移未执行**：`projects_project` 表不存在
2. **开发环境数据库状态不一致**：模型定义存在但表未创建
3. **部署流程缺少迁移步骤**：生产环境可能遇到同样问题

### 错误日志
```
sqlite3.OperationalError: no such table: projects_project
django.db.utils.OperationalError: no such table: projects_project
```

## 💡 解决方案

### 1. 执行数据库迁移
```bash
cd backend
python manage.py makemigrations
python manage.py migrate
```

### 2. 检查迁移状态
```bash
python manage.py showmigrations
```

### 3. 重置数据库（如需要）
```bash
# 删除现有数据库文件
rm db.sqlite3
# 重新创建迁移和数据库
python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
```

## 🛡️ 预防措施

### 开发阶段
- 每次模型变更后立即执行迁移
- 将迁移文件纳入版本控制
- 定期检查迁移状态

### 部署阶段
- 部署脚本中包含迁移命令
- 生产环境部署前备份数据库
- 使用 `--check` 参数验证迁移

## 📚 经验总结

### 关键教训
1. **迁移管理重要性**：Django项目必须正确管理数据库迁移
2. **开发环境一致性**：确保开发环境与生产环境数据库状态一致
3. **部署流程完整性**：部署清单应包含数据库迁移步骤

### 最佳实践
- 使用 `python manage.py check` 检查项目配置
- 定期运行 `python manage.py showmigrations` 查看迁移状态
- 在 CI/CD 流程中集成迁移检查

---

**创建日期**：2025年8月9日  
**解决状态**：待解决  
**相关文件**：`backend/logs/django.log`, `backend/projects/models.py`